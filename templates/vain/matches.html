{% extends "layout.html" %}

{% block title_description %}
<title>VainLab Matches | Vainglory ゲーム履歴を表示・分析・共有しよう</title>
<meta name="description" content="VainLab 【ベインラボ】 Vainglory API を用いた分析ツールで、ゲーム履歴を表示・共有したり、統計分析で勝率アップを目指そう！">
{% endblock %}

{% block custom_css %}
<link href="{{ url_for('static', filename='vain/style.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='vain/sprite/hero-32.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='vain/glyphter-font/css/Glyphter.css') }}" rel="stylesheet">
{% endblock %}


{% block content %}
<div class="matches-main">

  <div class="header">
    <a href="{{ url_for('vain.index') }}">
      <img src="{{ url_for('static', filename='vain/vainlab-logo_pink.svg') }}">
    </a>
    <div class="search-form">
      {% include "vain/search-ign.html" %}
    </div>
  </div>


  <div class="all-matches">
    {% if matches.errors %} <p>Error: {{ matches.errors }}</p>
    {% else %}

    <!-- Matches data -->
    {% set p = players[player_id] %}
    <div class="player-info">
      <div class="player-tier" style="background-image: url( {{ url_for('static', filename='vain/tiers-cropped/t{}.png'.format(p.tier)) }} );">
        <div class="player-name-stats">
          <span id="player-name">{{ p.name }}</span>
          <p>
          ELO: {{ p.elo | int }}<br>
          勝利数: {{ p.wins }}
          </p>
        </div>
      </div>
    </div>

    {% for m in matches %}
    {% set p = this_player(m, player_id) %}
    <div class="single-match">

      <div class="m-summary">
        <div class="role">
          <div class="won" style="background-color: {{ '#ffce2d' if p.won else '#888888' }};">
            {% set actor = p.actor.replace('*', '') %}
            <img class="hero" src="{{ url_for('static', filename='vain/hero/' + actor + '_Portrait.png') }}">
          </div>
        </div>
        <div class="mode-won">
          <span class="mw-mode">{{ m.mode }}</span>
          <span class="mw-won">{{ ('敗北', '勝利')[p.won] }}</span>
        </div>
      </div>

      <div class="m-details">
        <div class="item-build-wrapper">
          <div class="item-build">
            {% for i in p['items'] %}
            <div class="single-item">
              {% set iname = itemname_to_cssreadable(i) %}
              <img src="{{ url_for('static', filename='vain/items/' + iname + '.png') }}">
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="player-stats">
          <div class="kda">
            <dt>KDA:</dt>
            <dd>
            <!-- KDA http://vainglory.pchw.io/entry/2016/02/29/092408 -->
            <i class="icon-kills"></i>{{ p.kda | round(2) }}
            ({{ p.kills }}/{{ p.deaths }}/{{ p.assists }})</dd>
          </div>
          <div class="gold">
            <dt>Gold:</dt>
            <dd><i class="icon-gold"></i>{{ p.gold }}</dd>
          </div>
          <div class="cs">
            <dt>CS:</dt>
            <dd><i class="icon-cs"></i>{{ p.farm }}</dd>
          </div>
          {# <i class="icon-duration"></i>{{ m.duration }} #}
        </div>

        <div class="rosters">
          {% for r in m.rosters %}
          <div class="roster {{ r.side }}" style="color: {{ r.side.split('-')[1] }};">
            <div class="roster-stats">
              <p>
              <i class="icon-kills"></i>{{ r.team_kill_score }}
              <i class="icon-turrets"></i>{{ r.turret_kill }}
              </p>
            </div>

            <div class="roster-participants">
              {% for p in r.participants %}
              <i class="sprite-hero-32-{{ p.actor.replace('*', '') }}_Portrait"></i>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

    </div>
    {% endfor %}
  </div>
  
  <div class="footer">
    {% include "vain/footer.html" %}
  </div>
</div>

{% endif %}
{% endblock %}
